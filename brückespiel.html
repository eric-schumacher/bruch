<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Br√ºche vergleichen ‚Äì Spiel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    :root {
        --main-bg: #fefefe;
        --accent: #fbb040;
        --good: #44c767;
        --bad: #e94e4e;
    }
    * {
        box-sizing: border-box;
    }
    body {
        font-family: 'Segoe UI', sans-serif;
        background: var(--main-bg);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }
    h1 {
        font-size: 1.8rem;
        margin: 10px;
        color: #333;
        text-align: center;
    }
    .score {
        font-size: 1rem;
        background: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        box-shadow: 0 0 5px #ccc;
        margin-bottom: 10px;
        display: inline-block;
        max-width: 90vw;
        text-align: left;
    }
    .game-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        padding: 20px;
        width: 100%;
        max-width: 800px;
        text-align: center;
    }
    select {
        font-size: 1rem;
        padding: 5px 10px;
        border-radius: 6px;
        border: 1px solid #aaa;
        margin-top: 5px;
    }
    .fractions {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        font-size: 1.4rem;
        flex-wrap: wrap;
        gap: 10px;
    }
    .fraction {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 80px;
    }
    .fraction .line {
        width: 40px;
        height: 2px;
        background: #000;
        margin: 2px 0;
    }
    .options button {
        padding: 10px 18px;
        margin: 10px 5px;
        font-size: 1rem;
        border: none;
        border-radius: 6px;
        background-color: var(--accent);
        color: white;
        cursor: pointer;
        transition: background 0.2s;
        width: 90%;
        max-width: 250px;
    }
    .options {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    .options button:hover {
        background-color: #e59e2e;
    }
    .canvases {
        display: flex;
        justify-content: space-evenly;
        flex-wrap: nowrap;
        gap: 10px;
        margin-top: 30px;
    }
    canvas {
        border: 1px solid #ccc;
        background: #fff;
        border-radius: 8px;
        flex: 1 1 40%;
        max-width: 180px;
        height: auto;
        aspect-ratio: 1 / 1;
    }
    .help-inputs {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
    }
    .help-input {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
    }
    .help-input input {
        width: 3rem;
        text-align: center;
        font-size: 1rem;
        padding: 4px;
        border: 1px solid #aaa;
        border-radius: 5px;
    }
    .help-line {
        height: 1px;
        background: #000;
        width: 100%;
    }
    .animation {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 10rem;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 9999;
    }
    .confetti {
        color: var(--good);
    }
    .sad {
        color: var(--bad);
    }
</style>
</head>
<body>

<div class="score">
    üèÜ Highscore: <span id="highscore">0</span><br>
    ‚≠ê Punkte: <span id="score">0</span>
</div>

<div class="smileys" id="smileys" style="font-size: 2rem; text-align: center;">
    üòä üòä üòä üòä üòä
</div>

<div class="game-container">
    <h1>Welcher Bruch ist gr√∂√üer?</h1>

    <label for="difficulty">Schwierigkeitsgrad: </label>
    <select id="difficulty" onchange="newTask()" style="margin-bottom: 10px;">
        <option value="easy">Leicht (1‚Äì5)</option>
        <option value="medium" selected>Mittel (1‚Äì10)</option>
        <option value="hard">Schwer (1‚Äì20)</option>
    </select>

    <div class="fractions">
        <div class="fraction" id="leftFraction">
            <div id="leftNum">1</div>
            <div class="line"></div>
            <div id="leftDen">2</div>
        </div>
        <div style="font-size: 1.6rem;">vs</div>
        <div class="fraction" id="rightFraction">
            <div id="rightNum">2</div>
            <div class="line"></div>
            <div id="rightDen">4</div>
        </div>
    </div>

    <div class="options">
        <button onclick="checkAnswer('left')">Links ist gr√∂√üer</button>
        <button onclick="checkAnswer('equal')">Beide gleich gro√ü</button>
        <button onclick="checkAnswer('right')">Rechts ist gr√∂√üer</button>
    </div>

    <h2 style="margin-top:20px;">üîß Hilfe</h2>

    <div class="canvases">
        <canvas id="leftCanvas" width="200" height="200"></canvas>
        <canvas id="rightCanvas" width="200" height="200"></canvas>
    </div>

    <div class="help-inputs">
        <div class="help-input">
            <input id="leftHelpNum" type="number" min="0" value="0" oninput="helpUsed=true; drawFraction('leftCanvas', this.value, document.getElementById('leftHelpDen').value)">
            <div class="help-line"></div>
            <input id="leftHelpDen" type="number" min="1" value="1" oninput="helpUsed=true; drawFraction('leftCanvas', document.getElementById('leftHelpNum').value, this.value)">
        </div>
        <div class="help-input">
            <input id="rightHelpNum" type="number" min="0" value="0" oninput="helpUsed=true; drawFraction('rightCanvas', this.value, document.getElementById('rightHelpDen').value)">
            <div class="help-line"></div>
            <input id="rightHelpDen" type="number" min="1" value="1" oninput="helpUsed=true; drawFraction('rightCanvas', document.getElementById('rightHelpNum').value, this.value)">
        </div>
    </div>
</div>

<div id="animation" class="animation"></div>

<script>
let score = 0;
let errors = 0;
const maxErrors = 5;
let helpUsed = false;
let left = { num: 1, den: 2 };
let right = { num: 2, den: 4 };

window.onload = function () {
    const savedHighscore = localStorage.getItem("bruch_highscore");
    if (savedHighscore) {
        document.getElementById("highscore").textContent = savedHighscore;
    }
    updateSmileys();
};

function updateSmileys() {
    const smileyContainer = document.getElementById("smileys");
    let output = "";
    for (let i = 0; i < maxErrors; i++) {
        output += i < errors ? "üò¢ " : "üòä ";
    }
    smileyContainer.textContent = output.trim();
}

function endGame() {
    alert("Du hast leider verloren! Dein Punktestand: " + score.toFixed(1));
    const oldHighscore = parseFloat(localStorage.getItem("bruch_highscore") || "0");
    if (score > oldHighscore) {
        localStorage.setItem("bruch_highscore", score.toFixed(1));
        document.getElementById("highscore").textContent = score.toFixed(1);
    }
    score = 0;
    errors = 0;
    updateSmileys();
    document.getElementById('score').textContent = score.toFixed(1);
    newTask();
}

function drawFraction(canvasId, numerator, denominator) {
    numerator = Math.max(0, parseInt(numerator) || 0);
    denominator = Math.max(1, parseInt(denominator) || 1);
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 200, 200);
    const cx = 100, cy = 100, r = 80;
    const angle = 2 * Math.PI / denominator;

    for (let i = 0; i < denominator; i++) {
        const start = -Math.PI / 2 + i * angle;
        const end = start + angle;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, r, start, end);
        ctx.closePath();

        ctx.fillStyle = i < numerator ? "#fbb040" : "#ffffff";
        ctx.fill();
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.stroke();
    }
}

function updateDisplay() {
    document.getElementById('leftNum').textContent = left.num;
    document.getElementById('leftDen').textContent = left.den;
    document.getElementById('rightNum').textContent = right.num;
    document.getElementById('rightDen').textContent = right.den;

    document.getElementById('leftHelpNum').value = 0;
    document.getElementById('leftHelpDen').value = 1;
    document.getElementById('rightHelpNum').value = 0;
    document.getElementById('rightHelpDen').value = 1;
    drawFraction('leftCanvas', 0, 1);
    drawFraction('rightCanvas', 0, 1);
    helpUsed = false;
}

function randomFraction() {
    const difficulty = document.getElementById("difficulty")?.value || "medium";
    let max = 10;
    if (difficulty === "easy") max = 5;
    else if (difficulty === "hard") max = 20;

    const den = Math.floor(Math.random() * (max - 1)) + 2;
    const num = Math.floor(Math.random() * den) + 1;
    return { num, den };
}

function showAnimation(type) {
    const anim = document.getElementById("animation");
    anim.textContent = type === "confetti" ? "üéâ" : "üò¢";
    anim.className = "animation " + (type === "confetti" ? "confetti" : "sad");
    anim.style.opacity = 1;
    setTimeout(() => anim.style.opacity = 0, 800);
}

function newTask() {
    left = randomFraction();
    right = randomFraction();
    updateDisplay();
}

function checkAnswer(choice) {
    const leftVal = left.num / left.den;
    const rightVal = right.num / right.den;
    let correct = '';
    if (Math.abs(leftVal - rightVal) < 0.01) correct = 'equal';
    else if (leftVal > rightVal) correct = 'left';
    else correct = 'right';

    const diff = document.getElementById("difficulty")?.value || "medium";
    let gain = 0;
    if (diff === "easy") gain = helpUsed ? 0.5 : 1;
    else if (diff === "hard") gain = helpUsed ? 1.5 : 3;
    else gain = helpUsed ? 1 : 2;

    if (choice === correct) {
        score += gain;
        showAnimation("confetti");
    } else {
        score -= gain;
        errors++;
        updateSmileys();
        showAnimation("sad");
        if (errors >= maxErrors) {
            endGame();
            return;
        }
    }

    document.getElementById('score').textContent = score.toFixed(1);
    newTask();
}

updateDisplay();
</script>
</body>
</html>
